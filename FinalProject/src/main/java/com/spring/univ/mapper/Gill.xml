<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="Gill">

	<!-- 학생 리스트 가져오기 -->
	<select id="getStudentList" parameterType="HashMap" resultType="com.spring.univ.model.MemberVO">
	     select hakbun, name, birth, (select deptName
	     							 from tbl_department
	     							 where deptCode = fk_deptCode) as fk_deptCode,
	     		pwd, email, address, status, picture, phone, authority
		 from
		 (
		    select hakbun, name, birth, fk_deptCode, pwd, email, address, status, picture, phone, authority
		    from tbl_member
		 ) V
        <!-- 검색어 미 입력시 -->
        <if test='status == "no" and fk_deptCode == "no" and searchType == "no" and searchWord == "no"'>
    	     where authority = #{authority}
        </if>
        <if test='status != "no" and fk_deptCode == "no" and searchType == "no" and searchWord == "no"'>
    	     where authority = #{authority} and status = #{status}
        </if>
        <if test='status == "no" and fk_deptCode != "no" and searchType == "no" and searchWord == "no"'>
    	     where authority = #{authority} and fk_deptCode = #{fk_deptCode}
        </if>
        <if test='status != "no" and fk_deptCode != "no" and searchType == "no" and searchWord == "no"'>
    	     where authority = #{authority} and status = #{status} and fk_deptCode = #{fk_deptCode}
        </if>	    
        
        <!-- 검색어 입력시 -->
		<if test='status != "no" and fk_deptCode == "no" and searchType !="no" and searchWord != "no"'>
    	     where authority = #{authority} and status = #{status} and ${searchType} = #{searchWord}
        </if>
        <if test='status == "no" and fk_deptCode != "no" and searchType !="no" and searchWord != "no"'>
    	     where authority = #{authority} and fk_deptCode = #{fk_deptCode} and ${searchType} = #{searchWord}
        </if>
        <if test='status != "no" and fk_deptCode != "no" and searchType !="no" and searchWord != "no"'>
    	     where authority = #{authority} and status = #{status} and fk_deptCode = #{fk_deptCode} and ${searchType} = #{searchWord}
        </if>
	</select>
	
	<!-- 과목 리스트 가져오기 -->
	<select id="getSubjectList" parameterType="HashMap" resultType="com.spring.univ.model.SubjectVO">
	     select subject, ban, (select deptName
	     							 from tbl_department
	     							 where deptCode = fk_deptCode) as fk_deptCode, hakjum, classDate     		
		 from
		 (
		    select subject, ban, fk_deptCode, hakjum, classDate
		    from tbl_subject
		 ) V
        <!-- 검색어 미 입력시 -->
        <if test='classDate != "no" and fk_deptCode == "no" and searchType == "no" and searchWord == "no"'>
    	     where classDate = #{classDate}
        </if>
        <if test='classDate == "no" and fk_deptCode != "no" and searchType == "no" and searchWord == "no"'>
    	     where fk_deptCode = #{fk_deptCode}
        </if>
        <if test='classDate != "no" and fk_deptCode != "no" and searchType == "no" and searchWord == "no"'>
    	     where classDate = #{classDate} and fk_deptCode = #{fk_deptCode}
        </if>	    
        
        <!-- 검색어 입력시 -->
		<if test='status != "no" and fk_deptCode == "no" and searchType !="no" and searchWord != "no"'>
    	     where classDate = #{classDate} and ${searchType} = #{searchWord}
        </if>
        <if test='status == "no" and fk_deptCode != "no" and searchType !="no" and searchWord != "no"'>
    	     where fk_deptCode = #{fk_deptCode} and ${searchType} = #{searchWord}
        </if>
        <if test='status != "no" and fk_deptCode != "no" and searchType !="no" and searchWord != "no"'>
    	     where classDate = #{classDate} and fk_deptCode = #{fk_deptCode} and ${searchType} = #{searchWord}
        </if>
        order by ban
	</select>
	
	<!-- 과목 및 과목번호 가져오기 -->
	<select id="getDeptList" resultType="com.spring.univ.model.DepartmentVO">
	     select deptCode, deptName
		from tbl_department
		order by deptCode
	</select>
	
	<!-- 새로운 회원 입력하기 -->
	<insert id="UpdateMember" parameterType="HashMap">
		insert into tbl_member(hakbun, name, birth, fk_deptCode, pwd, email, address, status, picture, phone, authority)
		values(#{hakbun}, #{name}, #{non}, #{fk_deptCode}, 'qwer1234$', #{non}, #{non}, '0', #{non}, #{non}, #{authority})
	</insert>
	
	<!-- 학번 중복여부 가져오기 -->
	<select id="getcheckHakbun" parameterType="HashMap" resultType="String">
	    select hakbun
		from tbl_member
		where hakbun = #{hakbun}
	</select>
	
	<!-- 담당교수 가져오기 -->
	<select id="getTeacherList" resultType="com.spring.univ.model.SubjectVO">
    	select teacher, fk_deptCode
    	from tbl_subject
	</select>
	
	<!-- 새로운 전공 입력하기 -->
	<insert id="UpdateSubject" parameterType="HashMap">
		insert into tbl_subject(code, subject, teacher, hakjum, classDate, fk_deptCode)
		values(#{code}, #{subject}, #{teacher}, #{hakjum}, #{classDate}, #{fk_deptCode})
	</insert>
	
	<!-- 학과명 중복여부 가져오기 -->
	<select id="getcheckSubject" parameterType="HashMap" resultType="String">
	    select subject
		from tbl_subject
		where subject = #{subject} 
	</select>
	
	<!-- 학과코드 중복여부 가져오기 -->
	<select id="getcheckCode" parameterType="HashMap" resultType="String">
	    select code
		from tbl_subject
		where code = #{code}
	</select>
	
</mapper>