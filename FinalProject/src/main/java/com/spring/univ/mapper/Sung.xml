<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="Sung">

	<resultMap type="HashMap" id="subjectMap">
		<result property="code" column="code" javaType="String" />
		<result property="subject" column="subject" javaType="String" />
		<result property="fk_hakbun" column="fk_hakbun" javaType="String" />
		<result property="name" column="name" javaType="String" />
		<result property="hakjum" column="hakjum" javaType="String" />
		<result property="classdate" column="classdate" javaType="String" />
		<result property="deptcode" column="deptcode" javaType="String" />
		<result property="deptName" column="deptName" javaType="String" />
		<result property="deptLocation" column="deptLocation" javaType="String" />
	</resultMap>

	<select id="getSubjectInfo" parameterType="String" resultMap="subjectMap"> 
		select A.code AS code, A.subject AS subject, A.fk_hakbun AS fk_hakbun, C.name AS name, A.hakjum AS hakjum, A.classdate AS classdate, A.fk_deptcode AS deptcode, B.deptName AS deptName, B.deptLocation AS deptLocation
		from tbl_subject A
		JOIN tbl_department B
		on A.fk_deptcode = B.deptCode
		JOIN tbl_member C
		on A.fk_hakbun = C.hakbun
		where code = #{code}
	</select>
	
	
	<select id="getLessonBoard" parameterType="String" resultType="com.spring.univ.model.LessonBoardVO">
		select seq, fk_hakbun, fk_code, name, subject, content, pw, to_char(regdate,'yyyy-mm-dd hh24:mi:ss') as regDate, status, commentcount, filename, orgfilename, filesize
		from tbl_lessonboard
		where status = 1 and fk_code = #{code}
	</select>
	
	
	<resultMap type="HashMap" id="sugangMap">
		<result property="hakbun" column="hakbun" javaType="String" />
		<result property="code" column="code" javaType="String" />
		<result property="subject" column="subject" javaType="String" />
		<result property="teacher" column="teacher" javaType="String" />
		<result property="hakjum" column="hakjum" javaType="String" />
		<result property="classdate" column="classdate" javaType="String" />
		<result property="location" column="location" javaType="String" />
	</resultMap>
	
	<select id="getSugang" parameterType="String" resultMap="sugangMap">
		select hakbun, code, subject, teacher, hakjum, classdate, location
		from
		(
		select B.hakbun AS hakbun ,C.code AS code, C.subject AS subject, D.name AS teacher, C.hakjum AS hakjum, C.classdate AS classdate, E.deptlocation || ' ' || E.deptname AS location
		from tbl_sugang A
		JOIN tbl_member B
		on A.fk_hakbun = B.hakbun
		JOIN tbl_subject C
		on A.fk_code = C.code
		JOIN tbl_member D
		ON C.fk_hakbun = D.hakbun
		JOIN tbl_department E
		ON c.fk_deptcode = E.deptcode
		)
		where hakbun = #{hakbun}
	</select>
	
	<select id="checkSugang" parameterType="HashMap" resultType="int">
		select count(*)
		from tbl_sugang
		where fk_hakbun = #{hakbun} and fk_code= #{code}
	</select>
	
</mapper>